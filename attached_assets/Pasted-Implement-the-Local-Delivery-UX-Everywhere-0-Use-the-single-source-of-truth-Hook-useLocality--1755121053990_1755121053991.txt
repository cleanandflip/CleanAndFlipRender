Implement the â€œLocal Deliveryâ€ UX Everywhere
0) Use the single source of truth
Hook: useLocality() â†’ GET /api/locality/status (returns { isLocal, distanceMiles, hasAddress, defaultAddressId }).

Product flags: is_local_delivery_available, is_shipping_available.

Guard: Cart/checkout must call existing validation so non-local users canâ€™t add/buy local-only items.

Do not reintroduce zip-code checks or placeholders. Only the coordinate/radius method drives UI logic. 

1) Global UI building blocks (re-use everywhere)
LocalBadge

Props: { isLocal: boolean }

Renders:

Local: pill â€œLocal Delivery Areaâ€ with a check icon.

Non-local: pill â€œShipping Areaâ€ with an info icon.

Tooltip copy:

Local: â€œYou qualify for FREE Local Delivery within our 50-mile service zone.â€

Non-local: â€œYouâ€™re outside our local zone. Shipping is available on eligible items.â€

ProductAvailabilityChips

Props: { local: boolean; ship: boolean }

Renders:

local && ship â†’ â€œLocal Delivery & Shippingâ€

local && !ship â†’ â€œLocal Delivery Onlyâ€

!local && ship â†’ â€œShipping Onlyâ€

FreeDeliveryPill (local users only)

Copy: â€œFREE Local Deliveryâ€

Small truck icon, subtle success styling.

LocalityGate (logic wrapper)

Blocks Add to Cart if !isLocal && product.localOnly.

Shows inline explanation + CTA â€œUpdate addressâ€.

LocalBanner (contextual banners)

Local mode: â€œYouâ€™re in our Local Delivery area â€” delivery is FREE.â€

Non-local: â€œOutside our Local Delivery area. Shipping available on eligible items.â€

Use your design system tokens; keep pills compact (xs/sm), rounded-full, medium contrast.

2) Exact placements & behaviors
A) Nav header â†’ User dropdown
Top row: <LocalBadge isLocal={data?.isLocal} />

Underneath:

If local: â€œFREE Local Delivery to your default addressâ€ + link â€œManage addressesâ€.

If non-local: â€œShipping area onlyâ€ + link â€œAdd/Set default addressâ€.

If no default address: neutral pill â€œSet a default address to check Local Deliveryâ€.

tsx
Copy
Edit
const { data: loc } = useLocality();
<MenuItem><LocalBadge isLocal={!!loc?.isLocal} /></MenuItem>
<MenuItem href="/dashboard/addresses">
  {loc?.isLocal ? "FREE Local Delivery to your default address" : "Set default address to check Local Delivery"}
</MenuItem>
B) Profile â†’ Addresses tab
Each address card:

â€œDefaultâ€ badge if is_default.

Local status chip: â€œLocal Delivery Eligibleâ€ (success) or â€œShipping Areaâ€.

Page header (right side): <LocalBadge isLocal={loc.isLocal} />

When user sets a new default:

Recompute locality (already server-side) and toast result:

Local â†’ â€œDefault address qualifies for FREE Local Delivery.â€

Non-local â†’ â€œDefault address is outside local zone. Shipping only.â€

Provide â€œWhy local?â€ link to small explainer modal.

C) Product list cards & product detail (PDP)
On every product card:

<ProductAvailabilityChips local={p.is_local_delivery_available} ship={p.is_shipping_available} />

If local user and product supports local â†’ show FreeDeliveryPill.

Add to Cart button:

If !isLocal && localOnly â†’ disabled + tooltip â€œLocal Delivery only. Update your address to order.â€

If permitted â†’ your classic Blue â†’ Green (â€œIn Cartâ€) â†’ Red hover remove behavior.

PDP hero area:

Under price: chips + (if local & local-available) FreeDeliveryPill.

Small helper text:

Local users: â€œDelivered to your door at no cost.â€

Non-local users seeing local-only: â€œThis item isnâ€™t available for shipping to your address.â€

D) Cart drawer & Cart page
Top banner (sticky within cart): <LocalBanner />

Local: â€œFREE Local Delivery is applied to eligible items.â€

Non-local: â€œSome items may be Local Delivery only. Remove restricted items to checkout.â€

Each line item:

Small chip indicating item availability (â€œLocal Delivery Onlyâ€ / â€œShipping Onlyâ€ / â€œLocal & Shippingâ€).

If restricted for this user (shouldnâ€™t be addable, but survive stale states):

Red outline + inline alert â€œThis item is Local Delivery only.â€
Button: â€œRemove itemâ€.

Cart footer:

Local user: â€œDelivery: FREE Local Deliveryâ€ line in the breakdown.

Non-local: â€œDelivery: Calculated at checkoutâ€.

Remove from cart must call the new /api/cart/items/:id DELETE and invalidate ["cart"] only.

E) Checkout
Header row: <LocalBadge /> + (if local) FreeDeliveryPill.

Shipping method section:

Local user:

â€œLocal Delivery â€” FREEâ€ (preselected if item mix allows)

If cart contains any shipping-only items, also show â€œStandard Shippingâ€.

Non-local:

Only shipping options.

If cart includes any local-only item (should be guarded earlier), block with modal:

â€œLocal Delivery only item detected. Remove it to continue.â€

Primary: â€œRemove and continueâ€, Secondary: â€œBack to cartâ€.

Sidebar order summary:

Show delivery line explicitly (â€œLocal Delivery â€” FREEâ€ vs â€œShipping â€” $Xâ€).

Final â€œPlace Orderâ€ should re-validate via /api/cart/validate and surface helpful copy on failure.

F) Order confirmation & Orders list
Show a small tag beside each order:

â€œFulfilled by Local Deliveryâ€ or â€œFulfilled by Shippingâ€.

G) Marketing surfaces (smart but subtle)
Home top ribbon (personalized):

Local: â€œğŸ‰ Youâ€™re in our Local Delivery area â€” delivery is FREE.â€

Non-local + no default address: â€œAdd your address to see if you qualify for FREE Local Delivery.â€

Category empty states: remind of FREE Local Delivery for locals.

Toast moments:

When a local user adds a local-eligible product for the first time this session:
â€œNice â€” this will be delivered FREE to your default address.â€

3) Behavior rules (single truth across the site)
Local-only product = is_local_delivery_available && !is_shipping_available.

Non-local users: cannot add; show tooltip & â€œUpdate addressâ€ CTA.

Local users: normal flow; emphasize â€œFREE Local Deliveryâ€.

Shipping-only product = !is_local_delivery_available && is_shipping_available.

Everyone can add; no local pill.

Both = show both chips; for local users, emphasize FreeDeliveryPill.

No default address = treat as non-local for gating; nudge to set default.

All of the above rules line up with the unified cart guard and endpoints already documented, so the UI simply reflects the server decisions. 

4) Copy & visual guidelines
Keep all locality UI compact and reassuring. Avoid shouting except the top ribbon.

Colors: use your success palette for local advantages; neutral/secondary for â€œShipping Areaâ€.

Icons: check (local), truck (delivery), info (non-local explainer).

Accessibility: each badge has aria-label (â€œLocal Delivery Areaâ€, â€œShipping Areaâ€). Tooltips are keyboard-reachable.

5) Routing & state
Queries:

["locality"] for locality status.

["cart"] for cart.

Invalidations:

When default address changes â†’ invalidate ["locality"] + ["cart"].

No onboarding dependency: UI should work whether address was created in profile, checkout, or earlier. No legacy onboarding checks remain.

6) Purge & prevent regressions
Remove any pickup terminology. Local = delivery only.

Delete any legacy ZIP helpers, onboarding-gated local checks, and placeholder logic.

Lint/grep gates:

isLocalCustomer(, zip, pickup, Math.random() in checkout, old cart routes.

Unit tests:

Local vs non-local add-to-cart behavior.

Mixed cart validation and checkout blocking.

Address default change â†’ locality refresh.

7) Acceptance criteria (QA checklist)
Header dropdown always shows correct badge and links.

Address cards clearly show Default and Local Delivery Eligible state.

Product cards/PDP display correct chips and FreeDeliveryPill (when applicable).

Non-local user cannot add a Local Delivery Only product; sees clear reason and â€œUpdate addressâ€.

Cart and checkout show the same items and the correct delivery line (â€œFREE Local Deliveryâ€ for locals).

Checkout blocks incompatible carts with a friendly modal and a one-click fix (â€œRemove and continueâ€).

If Replit implements exactly the placements and behaviors aboveâ€”using the unified locality engine, badges, chips, and guard logicâ€”youâ€™ll get a clean, fast, and persuasive Local Delivery experience that markets the benefit in all the right places while preventing every class of â€œlocal-onlyâ€ mistake.
FIX: Wishlist Add Failing - nanoid is not defined
Good news: Authentication is now working! âœ“
New issue: Adding to wishlist fails with ReferenceError: nanoid is not defined
Error location: /server/storage.ts:927 in addToWishlist function
Fix Required:
Option 1 - Import nanoid:
javascript// At the top of storage.ts, add:
import { nanoid } from 'nanoid';

// OR if using CommonJS:
const { nanoid } = require('nanoid');
Option 2 - Use crypto.randomUUID() (recommended - no dependencies):
javascript// In addToWishlist function, replace:
// id: nanoid()

// With:
id: crypto.randomUUID()
Option 3 - Use your existing ID generation:
javascript// If you have a generateId() function elsewhere:
id: generateId()

// Or use database auto-generation:
// Remove the id field entirely and let the database generate it
Complete fix for addToWishlist:
javascriptasync addToWishlist(userId: string, productId: string) {
  try {
    console.log('Add to wishlist - userId:', userId, 'productId:', productId);
    
    // Check if already wishlisted
    const existing = await this.db
      .select()
      .from(wishlist)
      .where(and(
        eq(wishlist.userId, userId),
        eq(wishlist.productId, productId)
      ))
      .limit(1);
      
    if (existing.length > 0) {
      return { message: 'Already in wishlist', isWishlisted: true };
    }
    
    // Add to wishlist with proper ID
    await this.db.insert(wishlist).values({
      id: crypto.randomUUID(), // <-- FIX HERE
      userId,
      productId,
      createdAt: new Date()
    });
    
    return { success: true, message: 'Added to wishlist' };
  } catch (error) {
    console.error('Error in addToWishlist:', error);
    throw error;
  }
}
Also check other places using nanoid:
Search the codebase for other uses of nanoid() and replace them with crypto.randomUUID() or ensure nanoid is properly imported.
Quick test after fix:

Click heart icon on a product
Should turn filled/red
Check user profile - item should appear in wishlist
Check admin dashboard - wishlist analytics should show data

The authentication is working now, just need to fix this ID generation issue!
import{j as e}from"./vendor-query-CoA2KGsa.js";import{r as t}from"./vendor-react-Bg7tF2Ta.js";import{H as s,f as r}from"./index-D83mCZbl.js";import{L as o,X as a,m as n,c as l}from"./vendor-icons-owZ3yLAb.js";function i({value:i="",onChange:c,onAddressSubmit:d,placeholder:u="Start typing your address...",className:p,required:m,id:f,name:g,isLoading:x=!1,initialAddress:h}){const[b,v]=t.useState(i),[y,j]=t.useState([]),[w,N]=t.useState(!1),[A,C]=t.useState(!1),[$,z]=t.useState(null),S=t.useRef(null),k=s(b,300);t.useEffect(()=>{if(k.length<3)return void j([]);(async()=>{N(!0);try{const e="72df1f75e5bf41b8976bb411b5f9b6f9";console.log("Making address search request for:",k);const t=await fetch(`https://api.geoapify.com/v1/geocode/autocomplete?text=${encodeURIComponent(k)}&filter=countrycode:us&format=json&apiKey=${e}`);if(!t.ok)throw new Error(`API request failed: ${t.status} ${t.statusText}`);const s=await t.json();console.log("API response:",s),s.results&&Array.isArray(s.results)?(j(s.results),C(!0),console.log(`Found ${s.results.length} suggestions`)):(console.log("No results in API response"),j([]))}catch(e){console.error("Address search error:",e),j([])}finally{N(!1)}})()},[k]);const q=e=>{const t=`${e.housenumber||""} ${e.street||""}`.trim(),s=e.city||e.town||e.village||"",r=e.state_code||e.state||"",o=e.postcode||"";return{street:t,city:s,state:r,zipCode:o,fullAddress:`${t}, ${s}, ${r} ${o}`.replace(/\s+/g," ").trim(),coordinates:{lat:e.lat,lng:e.lon}}},E=()=>{v(""),j([]),C(!1),z(null),c&&c({street:"",city:"",state:"",zipCode:"",fullAddress:""})};return t.useEffect(()=>{const e=e=>{S.current&&!S.current.contains(e.target)&&C(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),e.jsxs("div",{ref:S,className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",id:f,name:g,value:b,onChange:e=>{v(e.target.value),e.target.value||E()},placeholder:u,required:m,className:r("w-full px-3 py-3 bg-input border border-input","text-input-foreground placeholder:text-white rounded-lg","focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent","transition-all duration-200",p),autoComplete:"off"}),w&&e.jsx(o,{className:"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-blue-500 animate-spin"}),!w&&b&&e.jsx("button",{type:"button",onClick:E,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-input-foreground transition-colors",children:e.jsx(a,{className:"h-4 w-4"})})]}),A&&y.length>0&&e.jsx("div",{className:"absolute z-[100] w-full mt-1 bg-popover border border-input rounded-lg shadow-2xl max-h-60 overflow-auto",style:{top:"100%"},children:y.map((t,s)=>{const r=q(t);return e.jsx("button",{type:"button",onClick:()=>(e=>{const t=q(e);v(t.fullAddress),z(t),C(!1),j([]),c&&c(t),d&&d({street:t.street,city:t.city,state:t.state,zipCode:t.zipCode,latitude:t.coordinates?.lat,longitude:t.coordinates?.lng})})(t),className:"w-full px-4 py-3 text-left text-input-foreground hover:bg-accent focus:bg-accent focus:outline-none transition-colors border-b border-border last:border-0",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(n,{className:"h-4 w-4 text-gray-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-input-foreground",children:r.street}),e.jsxs("div",{className:"text-gray-400 text-sm",children:[r.city,", ",r.state," ",r.zipCode]})]})]})},t.place_id||s)})}),$&&(L=$,["28801","28802","28803","28804","28805","28806","28810","28813","28814","28815","28816"].includes(L.zipCode))&&e.jsxs("div",{className:"mt-2 text-sm text-green-500 flex items-center gap-1",children:[e.jsx(l,{className:"w-4 h-4"}),"Local pickup available in Asheville"]})]});var L}export{i as A};

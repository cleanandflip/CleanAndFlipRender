import{a as e,b as s,j as r}from"./vendor-query-CoA2KGsa.js";import{r as t}from"./vendor-react-Bg7tF2Ta.js";import{u as a,o as l,s as i}from"./vendor-form-DFvvgXD3.js";import{F as n,a as o,b as c,c as d,d as m,e as h,t as x}from"./zod-DGgt3RV_.js";import{u as w,L as u}from"./vendor-router-CuiUI5dJ.js";import{a as j,C as b,s as f,q as p,r as g,J as N,B as v,I as y}from"./index-BM-Jcr-U.js";import{A as P,a as k}from"./alert-D32rFA5X.js";import{L as C,b as E,K as S,c as L,an as q,E as F}from"./vendor-icons-owZ3yLAb.js";import"./vendor-ui-BRIy5LFq.js";import"./vendor-utils-CrFdsnXa.js";const R=l({newPassword:i().min(8,"Password must be at least 8 characters").regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/,"Password must contain uppercase, lowercase, and number"),confirmPassword:i()}).refine(e=>e.newPassword===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]});function A(){w();const[l,i]=t.useState(""),[A,B]=t.useState(!1),[T,U]=t.useState(!1),[z,I]=t.useState(!1),{toast:J}=j();t.useEffect(()=>{const e=new URLSearchParams(window.location.search).get("token");e&&i(e)},[]);const K=a({resolver:x(R),defaultValues:{newPassword:"",confirmPassword:""}}),{data:O,isLoading:V,error:Y}=e({queryKey:["validate-token",l],queryFn:async()=>{if(!l)throw new Error("No token provided");const e=await fetch(`/api/auth/reset-password/${l}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to validate token");return e.json()},enabled:!!l,retry:!1}),$=s({mutationFn:async e=>{const s=await fetch("/api/auth/reset-password",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({token:l,newPassword:e.newPassword})});if(!s.ok){const e=await s.json();throw new Error(e.error||"Failed to reset password")}return s.json()},onSuccess:()=>{I(!0),J({title:"Password reset successfully",description:"You can now log in with your new password."})},onError:e=>{J({title:"Error",description:e.message,variant:"destructive"})}});return V?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-4",children:r.jsx(b,{className:"w-full max-w-md bg-white/10 backdrop-blur-md border-white/20",children:r.jsx(f,{className:"pt-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx(C,{className:"w-8 h-8 animate-spin text-blue-400 mx-auto mb-4"}),r.jsx("p",{className:"text-white",children:"Validating reset token..."})]})})})}):Y||!O?.valid?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-4",children:r.jsxs(b,{className:"w-full max-w-md bg-white/10 backdrop-blur-md border-white/20",children:[r.jsxs(p,{className:"text-center",children:[r.jsx("div",{className:"mx-auto w-16 h-16 bg-red-500/20 rounded-full flex items-center justify-center mb-4",children:r.jsx(E,{className:"w-8 h-8 text-red-400"})}),r.jsx(g,{className:"text-2xl font-bold text-white",children:"Invalid or Expired Link"}),r.jsx(N,{className:"text-gray-300",children:"This password reset link is invalid or has expired."})]}),r.jsx(f,{className:"text-center space-y-4",children:r.jsxs("div",{className:"flex flex-col gap-3",children:[r.jsx(u,{href:"/forgot-password",children:r.jsx(v,{className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:"Request New Reset Link"})}),r.jsx(u,{href:"/login",children:r.jsxs(v,{variant:"ghost",className:"w-full text-gray-300 hover:text-white hover:bg-white/10",children:[r.jsx(S,{className:"w-4 h-4 mr-2"}),"Back to Login"]})})]})})]})}):z?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-4",children:r.jsxs(b,{className:"w-full max-w-md bg-white/10 backdrop-blur-md border-white/20",children:[r.jsxs(p,{className:"text-center",children:[r.jsx("div",{className:"mx-auto w-16 h-16 bg-green-500/20 rounded-full flex items-center justify-center mb-4",children:r.jsx(L,{className:"w-8 h-8 text-green-400"})}),r.jsx(g,{className:"text-2xl font-bold text-white",children:"Password Reset Complete"}),r.jsx(N,{className:"text-gray-300",children:"Your password has been successfully updated."})]}),r.jsx(f,{className:"text-center",children:r.jsx(u,{href:"/login",children:r.jsx(v,{className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:"Continue to Login"})})})]})}):r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-4",children:r.jsxs(b,{className:"w-full max-w-md bg-white/10 backdrop-blur-md border-white/20",children:[r.jsxs(p,{className:"text-center",children:[r.jsx(g,{className:"text-2xl font-bold text-white",children:"Create New Password"}),r.jsx(N,{className:"text-gray-300",children:O?.email?`Resetting password for ${O.email}`:"Enter your new password below"})]}),r.jsxs(f,{children:[r.jsx(n,{...K,children:r.jsxs("form",{onSubmit:K.handleSubmit(e=>{$.mutate(e)}),className:"space-y-4",children:[r.jsx(o,{control:K.control,name:"newPassword",render:({field:e})=>r.jsxs(c,{children:[r.jsx(d,{className:"text-white",children:"New Password"}),r.jsx(m,{children:r.jsxs("div",{className:"relative",children:[r.jsx(y,{type:A?"text":"password",placeholder:"Enter new password",className:"bg-white/10 border-white/30 text-white placeholder-gray-400 focus:border-blue-400 pr-10",...e}),r.jsx("button",{type:"button",onClick:()=>B(!A),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white",children:A?r.jsx(q,{className:"w-4 h-4"}):r.jsx(F,{className:"w-4 h-4"})})]})}),r.jsx(h,{className:"text-red-400"})]})}),r.jsx(o,{control:K.control,name:"confirmPassword",render:({field:e})=>r.jsxs(c,{children:[r.jsx(d,{className:"text-white",children:"Confirm New Password"}),r.jsx(m,{children:r.jsxs("div",{className:"relative",children:[r.jsx(y,{type:T?"text":"password",placeholder:"Confirm new password",className:"bg-white/10 border-white/30 text-white placeholder-gray-400 focus:border-blue-400 pr-10",...e}),r.jsx("button",{type:"button",onClick:()=>U(!T),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white",children:T?r.jsx(q,{className:"w-4 h-4"}):r.jsx(F,{className:"w-4 h-4"})})]})}),r.jsx(h,{className:"text-red-400"})]})}),r.jsxs("div",{className:"text-sm text-gray-400",children:[r.jsx("p",{children:"Password requirements:"}),r.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[r.jsx("li",{children:"At least 8 characters long"}),r.jsx("li",{children:"Contains uppercase and lowercase letters"}),r.jsx("li",{children:"Contains at least one number"})]})]}),$.error&&r.jsx(P,{className:"bg-red-500/20 border-red-500/30",children:r.jsx(k,{className:"text-red-300",children:$.error.message})}),r.jsx(v,{type:"submit",disabled:$.isPending,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:$.isPending?"Updating Password...":"Update Password"})]})}),r.jsx("div",{className:"mt-6 text-center",children:r.jsx(u,{href:"/login",children:r.jsxs(v,{variant:"ghost",className:"text-gray-300 hover:text-white hover:bg-white/10",children:[r.jsx(S,{className:"w-4 h-4 mr-2"}),"Back to Login"]})})})]})]})})}export{A as default};

import{u as e,a,b as s,j as r}from"./vendor-query-CoA2KGsa.js";import{r as i}from"./vendor-react-Bg7tF2Ta.js";import{a as t,u as n}from"./vendor-router-CuiUI5dJ.js";import{a as o,p as l,B as d,C as c,q as p,r as u,s as m,L as g,I as h,T as x}from"./index-D83mCZbl.js";import{P as j}from"./price-input-CUpIg_gj.js";import{S as y}from"./UnifiedDropdown-D25oL3E9.js";import{K as b,X as v,O as f}from"./vendor-icons-owZ3yLAb.js";import"./vendor-ui-BRIy5LFq.js";import"./vendor-utils-CrFdsnXa.js";const w=["Rogue Fitness","Concept2","Bowflex","York Barbell","PowerBlock","Rep Fitness","Titan Fitness","CAP Barbell","Eleiko","Life Fitness","Hammer Strength","Cybex","Precor","Body-Solid","Nautilus","StairMaster","TRX","Assault Fitness","Sorinex","EliteFTS","Texas Power Bar","American Barbell","Ivanko","Iron Grip","HulkFit"];function N(){const N=t(),P=N?.id,[,k]=n(),{toast:F}=o();e();const C=!!P,[S,E]=i.useState({name:"",description:"",price:0,categoryId:"",stockQuantity:1,weight:0,condition:"like_new",brand:"",images:[]}),[q,A]=i.useState([]),{data:B=[]}=a({queryKey:["/api/categories"]}),{data:I,isLoading:M}=a({queryKey:["/api/products",P],queryFn:async()=>{if(!P)return null;const e=await fetch(`/api/products/${P}`,{credentials:"include"});if(!e.ok)throw new Error("Failed to fetch product");return e.json()},enabled:C&&!!P});i.useEffect(()=>{if(I&&C){const e=Array.isArray(I.images)?I.images:[];E({name:I.name||"",description:I.description||"",price:I.price||0,categoryId:I.categoryId||"",stockQuantity:I.stockQuantity||1,weight:I.weight||0,condition:I.condition||"like_new",brand:I.brand||"",images:e}),A(e)}},[I,C]);const[T,Q]=i.useState(!1),[$,D]=i.useState(0),z=(e,a)=>{const s=[...q],[r]=s.splice(e,1);s.splice(a,0,r),A(s)},G=s({mutationFn:async e=>{const a=C?`/api/admin/products/${P}`:"/api/admin/products",s=C?"PUT":"POST",r=await fetch(a,{method:s,body:e,credentials:"include"});if(!r.ok){const e=await r.text();throw new Error(e||"Failed to save product")}return r.json()},onSuccess:e=>{F({title:"Success",description:C?"Product updated successfully!":"Product created successfully!"});l(P||e?.id,C?"product_update":"product_create",{name:S.name,price:S.price,images:q,stockQuantity:S.stockQuantity}),k("/admin")},onError:e=>{F({title:"Error",description:"Failed to save product: "+e.message}),console.error(e)}});return r.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[r.jsxs("div",{className:"flex items-center gap-4",children:[r.jsxs(d,{variant:"ghost",onClick:()=>k("/admin"),children:[r.jsx(b,{className:"w-4 h-4 mr-2"}),"Back to Admin"]}),r.jsx("h1",{className:"text-3xl font-bold",children:C?"Edit Product":"Create New Product"})]}),r.jsxs("form",{onSubmit:e=>{if(e.preventDefault(),C&&M)return void F({title:"Loading",description:"Please wait while product data loads..."});if(!S.name||!S.brand||!S.categoryId||S.price<=0)return void F({title:"Validation Error",description:"Please fill in all required fields"});const a=new FormData,s=q;Object.entries(S).forEach(([e,s])=>{"images"!==e&&a.append(e,s.toString())}),s.length>0?s.forEach(e=>{a.append("images",e)}):a.append("images",""),G.mutate(a)},className:"space-y-6",children:[r.jsxs(c,{className:"glass-card",children:[r.jsx(p,{children:r.jsx(u,{children:"Basic Information"})}),r.jsxs(m,{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx(g,{htmlFor:"name",children:"Product Name *"}),r.jsx(h,{id:"name",value:S.name,onChange:e=>E({...S,name:e.target.value}),placeholder:"e.g., Rogue Ohio Power Bar",required:!0})]}),r.jsx("div",{children:r.jsx(y,{label:"Brand",options:w,value:S.brand,placeholder:"Search or select a brand...",onChange:e=>E({...S,brand:Array.isArray(e)?e[0]:e}),searchable:!0,allowCustom:!0,required:!0})})]}),r.jsxs("div",{children:[r.jsx(g,{htmlFor:"description",children:"Description"}),r.jsx(x,{id:"description",value:S.description,onChange:e=>E({...S,description:e.target.value}),placeholder:"Detailed product description...",rows:4})]})]})]}),r.jsxs(c,{className:"glass-card",children:[r.jsx(p,{children:r.jsx(u,{children:"Pricing & Inventory"})}),r.jsx(m,{children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsxs("div",{children:[r.jsx(g,{htmlFor:"price",children:"Price *"}),r.jsx(j,{id:"price",value:S.price,onChange:e=>E({...S,price:parseFloat(e.target.value)||0}),required:!0})]}),r.jsxs("div",{children:[r.jsx(g,{htmlFor:"stock",children:"Stock Quantity *"}),r.jsx(h,{id:"stock",type:"number",min:"0",value:S.stockQuantity,onChange:e=>E({...S,stockQuantity:parseInt(e.target.value)||0}),required:!0})]}),r.jsxs("div",{children:[r.jsx(g,{htmlFor:"weight",children:"Weight (lbs)"}),r.jsx(h,{id:"weight",type:"number",step:"0.1",min:"0",value:S.weight,onChange:e=>E({...S,weight:parseFloat(e.target.value)||0})})]})]})})]}),r.jsxs(c,{className:"glass-card",children:[r.jsx(p,{children:r.jsx(u,{children:"Category & Condition"})}),r.jsx(m,{children:r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx("div",{children:r.jsx(y,{label:"Category *",options:B.map(e=>({value:e.id,label:e.name})),value:S.categoryId,placeholder:"Select category",onChange:e=>E({...S,categoryId:Array.isArray(e)?e[0]:e}),required:!0})}),r.jsx("div",{children:r.jsx(y,{label:"Condition",options:[{value:"new",label:"New"},{value:"like_new",label:"Like New"},{value:"good",label:"Good"},{value:"fair",label:"Fair"},{value:"needs_repair",label:"Needs Repair"}],value:S.condition,placeholder:"Select condition",onChange:e=>E({...S,condition:Array.isArray(e)?e[0]:e}),required:!0})})]})})]}),r.jsxs(c,{className:"glass-card",children:[r.jsx(p,{children:r.jsx(u,{children:"Product Images"})}),r.jsxs(m,{className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[q.map((e,a)=>r.jsxs("div",{className:"relative group",children:[r.jsx("img",{src:e,alt:`Product ${a+1}`,className:"w-full h-32 object-cover rounded-lg border-2 border-gray-600"}),0===a&&r.jsx("span",{className:"absolute top-2 left-2 bg-blue-500 text-white text-xs px-2 py-1 rounded",children:"Primary"}),r.jsx(d,{type:"button",variant:"destructive",size:"sm",className:"absolute top-2 right-2 h-6 w-6 p-0 opacity-0 group-hover:opacity-100 transition-opacity z-10",onClick:e=>{e.preventDefault(),e.stopPropagation(),(e=>{const a=q.filter((a,s)=>s!==e);A(a)})(a)},children:r.jsx(v,{className:"w-3 h-3"})}),r.jsxs("div",{className:"absolute bottom-2 left-2 right-2 flex justify-between opacity-0 group-hover:opacity-100 transition-opacity",children:[a>0&&r.jsx(d,{type:"button",size:"sm",variant:"secondary",className:"h-6 w-6 p-0 text-xs",onClick:()=>z(a,a-1),title:"Move left",children:"←"}),a<q.length-1&&r.jsx(d,{type:"button",size:"sm",variant:"secondary",className:"h-6 w-6 p-0 text-xs ml-auto",onClick:()=>z(a,a+1),title:"Move right",children:"→"})]})]},a)),q.length<12&&r.jsxs("label",{className:"border-2 border-dashed border-gray-600 rounded-lg h-32 flex flex-col items-center justify-center cursor-pointer hover:border-gray-500 transition-colors",children:[r.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:async e=>{const a=Array.from(e.target.files||[]);if(0===a.length)return;if(q.length+a.length>12)F({title:"Too many images",description:`Maximum 12 images allowed per product. You currently have ${q.length} images.`});else{Q(!0),D(0);try{const s=a.map(async(e,s)=>{if(e.size>12582912)throw new Error(`File "${e.name}" is too large. Maximum size is 12MB.`);if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type))throw new Error(`File "${e.name}" has unsupported format. Only JPEG, PNG, and WebP are allowed.`);const r=new FormData;r.append("file",e);const i=await fetch("/api/upload/cloudinary",{method:"POST",body:r,credentials:"include"});if(!i.ok){const e=await i.json(),a=e.message||e.error||"Upload failed";throw new Error(a)}const t=await i.json();return D((s+1)/a.length*100),t.url}),r=await Promise.all(s),i=[...q,...r];A(i),E(e=>({...e,images:i})),e.target.value="",F({title:"Success",description:`${a.length} image(s) uploaded successfully! Total: ${i.length}/12 images.`})}catch(s){console.error("Upload error:",s),F({title:"Upload Failed",description:s.message||"Failed to upload images. Please try again.",variant:"destructive"})}finally{Q(!1),D(0)}}},className:"hidden",disabled:T}),T?r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto mb-2"}),r.jsxs("span",{className:"text-sm",children:[Math.round($),"%"]})]}):r.jsxs(r.Fragment,{children:[r.jsx(f,{className:"h-8 w-8 mb-2 text-gray-400"}),r.jsx("span",{className:"text-sm text-gray-400",children:"Add Images"}),r.jsx("span",{className:"text-xs text-gray-500 mt-1",children:"Max 12 images"})]})]})]}),r.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[r.jsx("p",{children:"• Maximum 12 images per product (industry standard)"}),r.jsx("p",{children:"• Each image can be up to 12MB"}),r.jsx("p",{children:"• Formats: JPEG, PNG, WebP"}),r.jsx("p",{children:"• Recommended: Square images (1500x1500px) for best quality"}),r.jsx("p",{children:"• First image will be the main product photo"})]})]})]}),r.jsxs("div",{className:"flex gap-4",children:[r.jsx("button",{type:"submit",disabled:G.isPending,className:"px-6 py-3 rounded-lg transition-all duration-200 focus:outline-none flex items-center gap-2 "+(G.isPending?"opacity-50 cursor-not-allowed":""),style:{background:"rgba(75, 85, 99, 0.4)",border:"1px solid rgba(156, 163, 175, 0.4)",color:"white",fontWeight:"500"},children:G.isPending?"Saving...":C?"Update Product":"Create Product"}),r.jsx("button",{type:"button",onClick:()=>k("/admin"),className:"px-6 py-3 rounded-lg transition-all duration-200 focus:outline-none flex items-center gap-2",style:{background:"transparent",border:"1px solid rgba(156, 163, 175, 0.4)",color:"white",fontWeight:"500"},children:"Cancel"})]})]})]})}export{N as ProductForm};
